# Задачи для установки и настройки Nginx
---
- name: Обновление кэша apt
  apt:
    update_cache: yes
    cache_valid_time: 3600

- name: Установка Nginx
  apt:
    name: nginx
    state: present

- name: Создание кастомной страницы приветствия
  template:
    src: index.html.j2
    dest: /var/www/html/index.html
    owner: www-data
    group: www-data
    mode: '0644'

- name: Остановка Nginx если запущен
  shell: "pkill nginx || true"
  changed_when: false

- name: Запуск Nginx напрямую
  shell: "nginx"
  changed_when: true

- name: Проверка что Nginx слушает порт 80
  wait_for:
    port: 80
    timeout: 30
